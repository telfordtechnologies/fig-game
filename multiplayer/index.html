<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Multiplayer Test</title>
</head>
<body>
  <h1></h1> <!-- This will store the player id string -->

  <canvas id="playfield" width="900" height="600"></canvas> 

  <script src="/socket.io/socket.io.js"></script> 
  <script type="module"> // "Module" just in case I wanted to import stuff

    // Setting up the playing field
    const h1Array = document.getElementsByTagName("h1");
    const idElement = h1Array[0];
    const canvas = document.getElementById("playfield");
    const ctx = canvas.getContext("2d");

    const socket = io.connect(); // Working theory is this is where we connect

    let playersArr = []; // We'll get this from the back end.
    let id;
    let playable;
    
    socket.on("ID ASSIGNMENT" , (data) => {
      id= "player" + data.number
      idElement.innerText = id
      playable = {id , x: 20 , y: 20}
      playersArr.push(playable)
      socket.emit("update" , playable)
    });
    socket.on("update" , (data) => {
      playersArr = [...data]
      socket.emit("update" , playable)
    })


    function draw(){
      ctx.clearRect(0, 0, canvas.width , canvas.height);
      ctx.beginPath();
      ctx.rect(0, 0, canvas.width , canvas.height);
      ctx.stroke();
      ctx.closePath();
      if(playersArr.length){
        playersArr.forEach(player => {
          ctx.beginPath();
          ctx.arc(player.x , player.y , 10 , 0 , Math.PI*2);
          ctx.stroke();
        });
      }
      requestAnimationFrame(draw)
    };
    draw();

    

function handleKeyDown(e){
  if(e.key == "ArrowRight"){
    playable.x += 10;
  };
  if(e.key == "ArrowLeft"){
    playable.x -= 10;
  };
  if(e.key == "ArrowUp"){
    playable.y -= 10;
  };
  if(e.key == "ArrowDown"){
    playable.y += 10;
  };
}

document.addEventListener("keydown" , handleKeyDown , false);
    
  </script>
</body>
</html>